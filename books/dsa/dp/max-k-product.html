<!DOCTYPE HTML>
<html lang="zh-CN" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>最大 K 乘积 | 明无梦的数据结构与算法学习之路</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom.css">


        <script>
            var localAddrs = ["localhost", "127.0.0.1", ""];
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                  var script = document.createElement('script');
                  script.async = true;
                  script.src = 'https://www.googletagmanager.com/gtag/js?id=G-XNJSCC1KSF';
                  document.head.appendChild(script);

                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('js', new Date());

                  gtag('config', 'G-XNJSCC1KSF');
            }
        </script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">简介</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> 基本数据结构 (Basic Data Structures</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.1.</strong> 单链表 (Linked list)</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../data-structure/slist/src.html"><strong aria-hidden="true">1.1.1.</strong> 实现</a></li><li class="chapter-item expanded "><a href="../data-structure/slist/doc.html"><strong aria-hidden="true">1.1.2.</strong> 文档</a></li></ol></li><li class="chapter-item expanded "><a href="../data-structure/queue/queue.html"><strong aria-hidden="true">1.2.</strong> 队列 (Queue)</a></li><li class="chapter-item expanded "><a href="../data-structure/binary-tree.html"><strong aria-hidden="true">1.3.</strong> 二叉树 (Binary Tree)</a></li><li class="chapter-item expanded "><a href="../data-structure/binary-heap.html"><strong aria-hidden="true">1.4.</strong> 二叉堆 (Binary heap)</a></li></ol></li><li class="chapter-item expanded "><a href="../dc/index.html"><strong aria-hidden="true">2.</strong> 分治算法 (Divide and conquer algorithms)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dc/rmq.html"><strong aria-hidden="true">2.1.</strong> 范围最值查询 (Range Minimum Query)</a></li><li class="chapter-item expanded "><a href="../dc/change-coin.html"><strong aria-hidden="true">2.2.</strong> 换硬币问题</a></li><li class="chapter-item expanded "><a href="../dc/subset.html"><strong aria-hidden="true">2.3.</strong> 子集问题</a></li><li class="chapter-item expanded "><a href="../dc/hanio.html"><strong aria-hidden="true">2.4.</strong> 汉诺塔 (Tower of Hanoi)</a></li><li class="chapter-item expanded "><a href="../dc/binary-search.html"><strong aria-hidden="true">2.5.</strong> 二分搜索 (Binary search)</a></li><li class="chapter-item expanded "><a href="../dc/quicksort.html"><strong aria-hidden="true">2.6.</strong> 快速排序 (Quicksort)</a></li><li class="chapter-item expanded "><a href="../dc/gray-code.html"><strong aria-hidden="true">2.7.</strong> 格雷码 (Gray code)</a></li></ol></li><li class="chapter-item expanded "><a href="../dp/index.html"><strong aria-hidden="true">3.</strong> 动态规划 (Dynamic programming)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dp/edit-distance.html"><strong aria-hidden="true">3.1.</strong> 编辑距离 (Edit distance)</a></li><li class="chapter-item expanded "><a href="../dp/digital-triangle.html"><strong aria-hidden="true">3.2.</strong> 数字三角形</a></li><li class="chapter-item expanded "><a href="../dp/max-k-product.html" class="active"><strong aria-hidden="true">3.3.</strong> 最大 K 乘积</a></li><li class="chapter-item expanded "><a href="../dp/01-knapsack.html"><strong aria-hidden="true">3.4.</strong> 0/1 背包问题 (0/1 knapsack problem)</a></li></ol></li><li class="chapter-item expanded "><a href="../greedy/index.html"><strong aria-hidden="true">4.</strong> 贪心算法 (Greedy algorithm)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../greedy/activity-selection.html"><strong aria-hidden="true">4.1.</strong> 活动选择问题 (Activity-selection problem</a></li><li class="chapter-item expanded "><a href="../greedy/optimal-decomposition.html"><strong aria-hidden="true">4.2.</strong> 最优分解问题</a></li></ol></li><li class="chapter-item expanded "><a href="../backtracking/index.html"><strong aria-hidden="true">5.</strong> 回溯算法 (Backtracking)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../backtracking/eight-queens-puzzle.html"><strong aria-hidden="true">5.1.</strong> 八皇后问题 (Eight queens puzzle)</a></li><li class="chapter-item expanded "><a href="../backtracking/minimum-weight-of-the-machine.html"><strong aria-hidden="true">5.2.</strong> 最小重量机器设计问题</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">明无梦的数据结构与算法学习之路</h1>

                    <div class="right-buttons">

                        <a href="https://www.mwum.com" target="_blank" rel="noopener noreferrer"><i id="home-button" class="fa fa-home"></i></a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="最大-k-乘积"><a class="header" href="#最大-k-乘积">最大 K 乘积</a></h1>
<h2 id="问题"><a class="header" href="#问题">问题</a></h2>
<p>有一个 n 位十进制整数 i, 将其划分为 k 个整数，这 k 个整数的乘积称为 i 的一个 k 乘积。
对于给定的  和 k, 求 i 的最大 k 乘积</p>
<h2 id="思路"><a class="header" href="#思路">思路</a></h2>
<p>将一个整数划分位 k 个整数，能不能将其转换为划分成 k-1 个整数的问题呢？
如果可行，同理 k-1 个整数可划分为 k-2 个整数，直到剩下一个整数，
然后将这些划分组合起来，原问题就能求解出来了</p>
<p>事实上确实是可行的，可以这么想：<br />
无论怎么划分，整数 i 的最后 1 位或者多位肯定被划分为一个整数（假设为 l 位），
那么除了这个整数，前面的 n-l 位必定被划分为 k-1 个整数。
假设将 i 划分成 k 个整数，最后一个整数为 l 位，这种情况为最大划分，
那么 i 前面的 n-l 位分成 k-1 个整数必定也为最大划分</p>
<p>可用反证法证明：<br />
设 <code>mkp[x][y]</code> 表示 i 的前 x 位组成的数分成 y 个整数，这 y 个整数的最大乘积<br />
设 <code>num[a][b]</code> 表示取 i 的第 a 到 b 位（包括 a, b 位且第一位为 <code>num[1][1]</code>）<br />
那么 <code>mkp[n][k]</code> 就表示 i 共有 n 位，且将其分成 k 个整数的，这 k 个整数的最大乘积<br />
假设将 i 划分成 k 个整数，最后一个整数为 l 位，这种情况为最大划分，
那么有如下等式成立：</p>
<pre><code>mkp[n][k] = mkp[n-l][k-1] * num[l][n]
</code></pre>
<p>如果 <code>mkp[n-l][k-1]</code> 不是最大划分，那么必定有 <code>mkp[n-l][k-1]'</code> 为最大划分，即有</p>
<pre><code>mkp[n-l][k-1] &lt; 'mkp[n-l][k-1]
</code></pre>
<p>那么</p>
<pre><code>mkp[n][k]' = mkp[n-l][k-1]' * num[l][n]
</code></pre>
<p>因为</p>
<pre><code>mkp[n-l][k-1]' &gt; mkp[n-l][k-1]
</code></pre>
<p>所以</p>
<pre><code>mkp[n][k]' &gt; mkp[n][k]
</code></pre>
<p>即 <code>mkp[n][k]</code> 不是最大划分，与上文 <code>mkp[n][k]</code> 为最大划分矛盾</p>
<p>以上证明了： 如果将 i 划分成 k 个整数，最后一个整数为 l 位，这种情况为最大划分，
那么 i 前面的 n-l 位分成 k-1 个整数必定也为最大划分</p>
<hr />
<p>经过以上分析，我们能够得到如下结论：</p>
<pre><code>mkp[x][y] = mkp[z][y-1] * num[z+1][x]
</code></pre>
<p>那么问题来了：我们不知道 z 的值，该怎么得到呢？<br />
对于这个问题规模比较小的情况下，我们可以采用枚举法：<br />
将 z 的所有可能值都取一遍，看看哪个 z 能使 <code>mkp[z][y-1] * num[z+1][x]</code> 最大，
这个最大值就是 <code>mkp[x][y]</code></p>
<hr />
<p>将以上所有思路整理一下，可得到如下最后的结论：</p>
<p><code>mkp[x][y]</code> 表示 i 的前 x 位组成的数分成 y 个整数，这 y 个整数的最大乘积<br />
<code>num[a][b]</code> 表示取 i 的第 a 到 b 位（包括 a, b 位且第一位为 <code>num[1][1]</code>）</p>
<p><code>mkp[x][y] = x</code>, 当 <code>y = 1</code> 时，此时只分成一个整数，就是 x<br />
<code>mkp[x][y] = max{ mkp[z][y-1] * num[z+1][x] }</code>, 其中 <code>y-1 &lt;= z &lt; x</code>, 当 <code>y != 1</code> 时<br />
其中 <code>x &gt;= y</code> 是肯定的，因为不可能把一个 n 位的整数分成 n+1 个整数（举个例子），
所以很好理解 <code>y-1 &lt;= z &lt; x</code></p>
<h2 id="代码"><a class="header" href="#代码">代码</a></h2>
<p>来举个具体的例子实践下吧，要不然都不明白我在说啥<br />
方法和编辑距离是一样的，先把子问题求解出来，然后一步步求解原问题<br />
比如：将 12345 分成 3 个整数</p>
<p>首先定义一个 mkp 矩阵，然后填入 y = 1 时候的值，如下图：</p>
<p><img src="images/2014-11-24_162212.svg" alt="mkp 矩阵填入 y=1 时候的值" /></p>
<p>其中打叉叉的是不可能取到的值，y 不可能大于 x</p>
<p>然后是计算 <code>y = 2</code> 的时候：
先计算 <code>mkp[2][2]</code>, 即计算 <code>max{ mkp[z][1] * num[z+1][2] }</code>, 其中 <code>1 &lt;= z &lt; 2</code><br />
...<br />
计算 <code>mkp[5][2]</code>, 即计算 <code>max{ mkp[z][1] * num[z+1][2] }</code>, 其中 <code>1 &lt;= z &lt; 5</code></p>
<p>最后计算 <code>y = 3</code> 的时候，直到计算完 <code>mkp[5][3]</code>, 即可得到原问题的解</p>
<p>填写好的矩阵如下：</p>
<p><img src="images/2014-11-24_170538.svg" alt="mkp 矩阵已经填写完毕" /></p>
<p>这样应该可以写出代码了，代码如下：</p>
<pre><code class="language-c">#include &lt;math.h&gt;

int num(int i, int n, int a, int b)
{
    return i / (int)pow(10, (n-b)) % (int)pow(10, b-a+1);
}

int max_of_mkpz(int n, int k, int mkp[n+1][k+1], int i, int x, int y)
{
    int max = mkp[y-1][y-1] * num(i, n, y, x);
    for (int z = y; z &lt; x; z++) {
        if (max &lt; (mkp[z][y-1] * num(i, n, z+1, x))) {
            max = mkp[z][y-1] * num(i, n, z+1, x);
        }
    }

    return max;
}

int max_k_product(int i, int k)
{
    int x, y;
    int n = (int)log10(i) + 1;
    int mkp[n+1][k+1];

    for (x = 1; x &lt;= n; x++) {
        mkp[x][1] = num(i, n, 1, x);
    }

    for (y = 2; y &lt;= k; y++) {
        for (x = y; x &lt;= n; x++) {
            mkp[x][y] = max_of_mkpz(n, k, mkp, i, x, y);
        }
    }

    return mkp[n][k];
}
</code></pre>
<h2 id="可进一步优化"><a class="header" href="#可进一步优化">可进一步优化</a></h2>
<p>仔细审查计算过程，其实 <code>mkp[4][1]</code>, <code>mkp[5][1]</code>, <code>mkp[5][2]</code>; <code>mkp[3][3]</code>, <code>mkp[3][4]</code> 是不用计算的<br />
找到的规律是如下的 mkp 值不用计算：<code>[4][2]</code> 和 <code>[5][3]</code> 直线以下和 <code>[5][3]</code> 往上的值可不计算，
在图中表示出来如下所示：</p>
<p><img src="images/2014-11-24_173730.svg" alt="mkp 矩阵标记可不计算的值" /></p>
<p>直线可表示成 <code>x - y = n - k</code></p>
<p>进而可写出如下代码：</p>
<pre><code class="language-c">#include &lt;math.h&gt;

/* 获取 i 的位数 */
int get_digital(int i)
{
    int     n = 0;
    while (i != 0) {
        i /= 10;
        n++;
    }
    return n;
}

/* 获取 i 的第 a 到 b 位组成的数字 */
int get_num(int i, int n, int a, int b)
{
    return i / (int)pow(10, (n-b)) % (int)pow(10, b-a+1);
}

/* calc max{ mkp[z][y-1] * num[z+1][x], y-1 &lt;= z &lt; x */
int max_of_mkpz(int n, int k, int mkp[n+1][k+1], int i, int x, int y)
{
    int max = mkp[y-1][y-1] * get_num(i, n, y, x);
    for (int z = y; z &lt; x; z++) {
        if (max &lt; (mkp[z][y-1] * get_num(i, n, z+1, x))) {
            max = mkp[z][y-1] * get_num(i, n, z+1, x);
        }
    }
    return max;
}

/* plus version */
int max_k_product(int i, int k)
{
    if (k == 1) {
        return i;
    }

    int x, y;
    int n = get_digital(i);
    int mkp[n+1][k+1];

    for (x = 1; x &lt;= n-k+1; x++) {
        mkp[x][1] = get_num(i, n, 1, x);
    }

    for (y = 2; y &lt; k; y++) {
        for (x = y; x &lt;= n-k+y; x++) {
            mkp[x][y] = max_of_mkpz(n, k, mkp, i, x, y);
        }
    }
    return max_of_mkpz(n, k, mkp, i, n, k);
}
</code></pre>
<p>很容易看到，空间复杂度可进一步优化，每次只会用到 mkp 矩阵的 2 列。
但是写出来的代码就比较复杂了</p>
<h2 id="分隔位置"><a class="header" href="#分隔位置">分隔位置</a></h2>
<p>其实我一直想知道分成的 k 个整数是哪几个，所以动手来实现吧</p>
<p>那么多子问题的解 <code>mkp[x][y]</code> 我们得想办法知道，使原问题取得最优解的那 k-1 个子问题</p>
<p>稍微分析一下可知，使 <code>mkp[z][y-1] * num[z+1][x]</code> 取得最大值的那个 z 就是分隔位置，
因为整个表达式的意思就是将整数 <code>num[1][x]</code> 分成 y 个整数的最优解，而 z 就是最后一个分隔位置</p>
<p>所以解法就很明确了，我可以先把所有子问题的 z 都保存下来。
当确定了原问题的最优解时，我们可以一步步往前推算各个 z.
比如我们知道了 <code>mkp[n][k]</code> 的最优解，且 <code>mkp[n][k] = mkp[z][k-1] * num[z+1][n]</code>
这其中的 z 就是最优解的一个分隔位置，然后计算 <code>mkp[n][k-1]</code> 的最优解的分隔位置，
直到算出整数 i 的第一个分隔位置</p>
<p>这部分的代码在下一节，无限精度</p>
<h2 id="无限精度"><a class="header" href="#无限精度">无限精度</a></h2>
<p>如果我们使用 int 型来计算，能算的整数位数非常有限，只有 9 位，这远远达不到我们爱玩的心态</p>
<p>所以稍微研究了一下，可以使用这个库实现我们的想法，
<a href="https://gmplib.org">The GNU Multiple Precision Arithmetic Library</a></p>
<p>以下是代码，只是重要部分的</p>
<pre><code class="language-c">#include "mkp.h"

/* 获取 i 的第 a 到 b 位组成的数字 rnt */
void get_num(mpz_t rnt, struct i_info *i_info, int a, int b)
{
    int n = i_info-&gt;len;
    mpz_t   pow;
    mpz_t   q;
    mpz_init(pow);
    mpz_init(q);

    mpz_ui_pow_ui(pow, 10, n-b);
    mpz_fdiv_q(q, i_info-&gt;i, pow);
    mpz_ui_pow_ui(pow, 10, b-a+1);
    mpz_fdiv_r(rnt, q, pow);

    mpz_clear(pow);
    mpz_clear(q);
}

/*
 * 计算 max{ mkp[z][y-1] * num[z+1][x] }, y-1 &lt;= z &lt; x,
 * 并返回使以上值最大那个 z
 */
int max_of_mkpz(mpz_t rnt,
                int n, int k, mpz_t mkp[n+1][k+1],
                struct i_info *i_info, int x, int y)
{
    int     maxz;
    mpz_t   temp;
    mpz_init(temp);

    get_num(temp, i_info, y, x);
    mpz_mul(rnt, mkp[y-1][y-1], temp);
    maxz = y-1;
    for (int z = y; z &lt; x; z++) {
        get_num(temp, i_info, z+1, x);
        mpz_mul(temp, mkp[z][y-1], temp);
        if (mpz_cmp(rnt, temp) &lt; 0) {
            mpz_set(rnt, temp);
            maxz = z;
        }
    }

    mpz_clear(temp);
    return maxz;
}

void process_two_dimensional_mpz(int n, int k, mpz_t mkp[n+1][k+1],
                                 void process(mpz_t))
{
    /*
     * 不用考虑 k = 1 的情况
     * 当这种情况发生时，max_k_product 直接返回 i 的值
     * 不会用到 mkp[][]
     */
    for (int y = 1; y &lt; k; y++) {
        for (int x = y; x &lt;= n-k+y; x++) {
            process(mkp[x][y]);
        }
    }
    process(mkp[n][k]);
}

void max_k_product(struct mkp_info *rnt, struct i_info *i_info)
{
    int k = i_info-&gt;k;
    if (k == 1) {
        mpz_set(rnt-&gt;mkp, i_info-&gt;i);
        rnt-&gt;pos[0] = 0;
        rnt-&gt;pos[k] = i_info-&gt;len;
        return;
    }

    int x, y;
    int n = i_info-&gt;len;
    int pos[n+1][k+1];
    mpz_t mkp[n+1][k+1];
    process_two_dimensional_mpz(n, k, mkp, mpz_init);

    for (x = 1; x &lt;= n-k+1; x++) {
        get_num(mkp[x][1], i_info, 1, x);
    }

    for (y = 2; y &lt; k; y++) {
        for (x = y; x &lt;= n-k+y; x++) {
            pos[x][y] = max_of_mkpz(mkp[x][y], n, k, mkp, i_info, x, y);
        }
    }
    pos[n][k] = max_of_mkpz(mkp[n][k], n, k, mkp, i_info, n, k);
    mpz_set(rnt-&gt;mkp, mkp[n][k]);

    /* pos 存储的是断开位置，指向的是前一个数的最后一个数字 */
    rnt-&gt;pos[0] = 0;
    rnt-&gt;pos[k] = n;
    for (y = k; y &gt; 1; y--) {
        rnt-&gt;pos[y-1] = pos[rnt-&gt;pos[y]][y];
    }

    process_two_dimensional_mpz(n, k, mkp, mpz_clear);
}
</code></pre>


                        <br>
                        <div id="remark42"></div>
                        <script>
                            var localAddrs = ["localhost", "127.0.0.1", ""];
                            if (localAddrs.indexOf(document.location.hostname) === -1) {
                                var remark_config = {
                                    host: 'https://comments.mwum.com',
                                    site_id: 'mwum',
                                    locale: 'zh',
                                    no_footer: true,
                                }
                                !function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);
                            }
                        </script>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../dp/digital-triangle.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../dp/01-knapsack.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../dp/digital-triangle.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../dp/01-knapsack.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
